/**
 * RG3 FB Photo Zoom
 * Author: Regis Gaughan, III
 * Email:  regis.gaughan@gmail.com
 * Web:    http://regisgaughan.com
 * (c) Copyright 2011. All Right Reserved
 */
var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-22980224-1"]);_gaq.push(["_trackPageview"]);_gaq.push(["_setSampleRate","1"]);(function(){var b=document.createElement("script");b.type="text/javascript";b.async=true;b.src="https://ssl.google-analytics.com/ga.js";var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(b,a)})();function toBool(a){if(false==a||"false"===a||0==a||"0"==a){return false}else{return true}}var currentImageUrl=null,openImageId=null,openImage=function(b,a){if(currentImageUrl){chrome.tabs.create({url:currentImageUrl,selected:true,index:a.index+1},function(){})}},optionsMenuId=null,openOptions=function(b,a){chrome.tabs.create({url:chrome.extension.getURL("html/options.html")+(b?"#"+b:""),selected:true,index:a||9999},function(){})};enableMenuId=null,enableMenuClick=function(b,a){RG3.storage.set("enabled",!RG3.storage.get("enabled"));chrome.contextMenus.update(enableMenuId,{checked:RG3.storage.get("enabled")});updateTabs()};Array.prototype.remove=function(c,b){var a=this.slice((b||c)+1||this.length);this.length=c<0?this.length+c:c;return this.push.apply(this,a)};var tabs=[];function addTab(a){if(tabs.indexOf(a.id)==-1){tabs.push(a.id)}}function removeTab(a){if(tabs.indexOf(a)>-1){tabs.remove(a)}}var t;function updateTabs(){for(var b=0,a=tabs.length;b<a;b++){chrome.tabs.sendRequest(tabs[b],{name:"updateOptions"},function(c){})}}chrome.tabs.onRemoved.addListener(function(a){removeTab(a)});chrome.extension.onRequest.addListener(function(e,g,a){switch(e.name){case"setEnabled":RG3.storage.set("enabled",!!e.value);chrome.contextMenus.update(enableMenuId,{checked:RG3.storage.get("enabled")});a({});updateTabs();if(e.value){_gaq.push(["_trackEvent","Functionality","Enabled"])}else{_gaq.push(["_trackEvent","Functionality","Disabled"])}break;case"get":if(req.key){a(RG3.storage.get(req.key))}else{if(req.keys){var f={},j=req.keys.split(","),h,b=j.length;for(h=0;h<b;h++){f[j[h]]=RG3.storage.get(j[h])}a(f)}}break;case"set":if(RG3.storage.get(req.key)!==req.value){RG3.storage.set(req.key,req.value);updateIcon();updateTabs()}a({});break;case"getOptions":var d={},c;for(var c in localStorage){d[c]=RG3.storage.get(c)}addTab(g.tab);a({value:d});break;case"updateTabs":updateTabs();a({});break;case"setCurrentImage":currentImageUrl=e.value;if(currentImageUrl&&!openImageId){openImageId=chrome.contextMenus.create({type:"normal",title:"Open zoomed photo in new tab",documentUrlPatterns:["http://*.facebook.com/*","http://facebook.com/*","https://*.facebook.com/*","https://facebook.com/*"],contexts:["all"],onclick:openImage},function(){})}else{if(!currentImageUrl&&openImageId){chrome.contextMenus.remove(openImageId);openImageId=null}}a({});if(e.value){_gaq.push(["_trackEvent","Photos","Zoom"])}break;case"openImage":openImage({},g.tab||{});a({});break;case"openOptions":openOptions();a({});break}});optionsMenuId=chrome.contextMenus.create({type:"normal",title:"Open Options",contexts:["all"],documentUrlPatterns:["http://*.facebook.com/*","http://facebook.com/*","https://*.facebook.com/*","https://facebook.com/*"],onclick:function(b,a){openOptions(null,a.index+1)}},function(){});enableMenuId=chrome.contextMenus.create({type:"checkbox",title:"Enabled",documentUrlPatterns:["http://*.facebook.com/*","http://facebook.com/*","https://*.facebook.com/*","https://facebook.com/*"],checked:RG3.storage.get("enabled")==null?true:!!RG3.storage.get("enabled"),contexts:["all"],onclick:function(b,a){enableMenuClick(null,a.index+1)}},function(){});if(!RG3.storage.get("launch_release20101207")){openOptions();RG3.storage.set("launch_release20101207",true)}if(!RG3.storage.get("release20110926_1")){_gaq.push(["_trackEvent","Install","1.1109.26.1"]);RG3.storage.set("release20110926_1",true)};